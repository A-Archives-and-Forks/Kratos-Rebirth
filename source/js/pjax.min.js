(()=>{if(!window.history||!window.history.pushState||!window.history.replaceState)return;function p(){const e=document.getElementById("kratos-blog-post").offsetTop,t=document.getElementById("kratos-desktop-topnav").offsetHeight,r=t?e-t:0;window.scrollTo({top:r,behavior:"smooth"})}function u(e,t,r){let n=e.querySelector('meta[property="'+t+'"]');if(n)r?n.setAttribute("content",r):n.parentNode&&n.parentNode.removeChild(n);else{if(!r)return;n=e.createElement("meta"),n.setAttribute("property",t),n.setAttribute("content",r),e.head.appendChild(n)}}function m(e,t){const r=e.querySelector('meta[property="'+t+'"]');return r?r.getAttribute("content"):null}function d(e,t){if(document.title=e.title||"\u65E0\u6807\u9898",t){const n=document.getElementById("main");typeof n.replaceWith=="function"?n.replaceWith(t.getElementById("main")):document.getElementById("main").innerHTML=e.content}else document.getElementById("main").innerHTML=e.content;const r=document.getElementById("main").getElementsByTagName("script");for(let n=0;n<r.length;n++){const o=r[n];if(!o.type||o.type.toLowerCase()==="text/javascript"){const i=document.createElement("script");i.setAttribute("type","text/javascript"),o.src?i.src=o.src:i.appendChild(document.createTextNode(o.text)),typeof o.replaceWith=="function"?o.replaceWith(i):(o.parentNode.insertBefore(i,o),o.parentNode.removeChild(o))}}u(document,"og:title",e.ogTitle),u(document,"og:url",e.ogUrl)}function f(e){return{title:e.title,ogTitle:m(e,"og:title"),ogUrl:m(e,"og:url"),content:e.getElementById("main").innerHTML}}function w(e){e.state&&(p(),typeof e.state.content>"u"?g(location.href,!1):d(e.state),window.dispatchEvent(s.complete))}window.addEventListener("popstate",w);const s={before:new Event("pjax:before"),success:new Event("pjax:success"),complete:new Event("pjax:complete"),error:new Event("pjax:error")};function g(e,t){const r=()=>{typeof load_comm<"u"&&load_comm!==null&&(load_comm=null),p(),NProgress.start(),window.dispatchEvent(s.before)},n=()=>{window.dispatchEvent(s.error),location.href=e},o=a=>{window.dispatchEvent(s.success);const c=document.implementation.createHTMLDocument("pjax");if(c.documentElement.innerHTML=a,!!c.getElementById("main")){t&&history.replaceState(f(document),document.title,location.href);const l=f(c);t&&window.history.pushState(l,l.title,e),d(l,c);const h=e.match(/\#(.+)$/);h&&window.scrollTo({top:document.getElementById(h[1]).offsetTop-40,behavior:"smooth"})}else{n();return}NProgress.done(),window.dispatchEvent(s.complete)},i=new XMLHttpRequest;i.onerror=function(a){console.error(a),n()},i.ontimeout=function(){n()},i.onreadystatechange=function(){i.readyState===4&&o(i.responseText)},i.open("GET",e,!0),i.timeout=6e3,r(),i.send()}const y=3;document.addEventListener("click",e=>{let t=e.target,r=0;for(;t&&t.tagName.toLowerCase()!=="a"&&r<y;)t=t.parentElement,r++;if(!t||t.tagName.toLowerCase()!=="a"||t.getAttribute("target")==="_blank"||t.getAttribute("rel")==="gallery"||t.getAttribute("class")==="toc-link")return;const n=t.getAttribute("href");if(!n||n.startsWith("#"))return;let o;try{if(o=new URL(n,location.origin),!o.protocol.toLowerCase().includes("http")||o.origin!==location.origin)return}catch(i){return}e.preventDefault(),o.href!==location.href&&g(o.toString(),!0)})})();
