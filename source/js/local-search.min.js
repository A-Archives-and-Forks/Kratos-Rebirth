function searchEscape(t){const a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return t.replace(/[&<>"'/]/g,function(n){return a[n]})}function regEscape(t){const a={"{":"\\{","}":"\\}","[":"\\[","]":"\\]","(":"\\(",")":"\\)","?":"\\?","*":"\\*",".":"\\.","+":"\\+","^":"\\^",$:"\\$"};return t.replace(/[\{\}\[\]\(\)\?\*\.\+\^\$]/g,function(n){return a[n]})}function getParam(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location);return n===null?"":decodeURIComponent(n[1].replace(/\+/g," "))}function setNotice(t,a){const n=document.getElementById("kr-search-notice");n.className="alert alert-"+t,n.innerText=a}function clearPosts(){const t=document.getElementById("result-posts");t.innerHTML=""}function createPosts(t){const a=document.getElementById("result-posts");let n="";t.forEach(h=>{const c=h[0];let o="";c.tags.forEach((r,l)=>{o+=l?", ":"";const f='<a class="tag-link" href="'.concat(r[1],'" rel="tag">').concat(r[0],"</a>");o+=f});const g='\n        <article class="kratos-hentry clearfix">\n            <div class="kratos-entry-border-new clearfix">\n                <div class="kratos-post-inner-new kr-search-result">\n                    <header class="kratos-entry-header-new">\n                        '.concat(c.category[0]!=="undefined"?'<a class="label-link" href="'.concat(c.category[1],'">').concat(c.category[0],"</a>"):"",'\n                        <h2 class="kratos-entry-title-new"><a href="').concat(c.link,'">').concat(c.title,'</a></h2>\n                    </header>\n                    <div class="kratos-entry-content-new">\n                        <p>...').concat(c.content,'...</p>\n                    </div>\n                </div>\n                <div class="kratos-post-meta-new">\n                    <span class="pull-left">\n                        <a><i class="fa fa-calendar"></i></a><a>').concat(c.date,'</a>\n                        <a><i class="fa fa-tags"></i></a>\n                        ').concat(o,"\n                    </span>\n                </div>\n            </div>\n        </article>\n        ");n+=g}),a.innerHTML=n}function loadDataSearch(t,a){fetch(t).then(n=>(setNotice("success","\u6587\u4EF6\u52A0\u8F7D\u5B8C\u6210\uFF0C\u5F00\u59CB\u641C\u7D22\u5566~"),typeof NProgress<"u"&&NProgress.inc(),n.json())).then(n=>{const h=performance.now();let c=[],o=0,g=a.trim().toLowerCase().split(/\s/);if(n.forEach(r=>{if(typeof r.title>"u"||typeof r.content>"u")return;let l=!1;const f=r.title.trim().toLowerCase(),p=r.content?r.content.trim().replace(/<[^>]+>/g,"").toLowerCase():"";let m=0,e={};e.title=-1,e.content=-1,e.firstOccur=-1,e.lastOccur=-1;const d=100;if(f&&g.forEach(s=>{e.title=f.indexOf(s),e.content=p.indexOf(s),(e.title!==-1||e.content!==-1)&&(l=!0,e.content!==-1?((e.firstOccur>e.content||e.firstOccur===-1)&&(e.firstOccur=e.content),e.lastOccur<e.content&&(e.lastOccur=e.content)):(e.firstOccur=d,e.lastOccur=0),m+=e.title!==-1?2:0,m+=e.content!==-1?1:0,o++)}),l){let s={};if(s.title=r.title,s.date=new Date(r.date).toLocaleDateString(),s.tags=r.tags||[],s.category=r.categories[0]||[],s.link=r.url,g.forEach(i=>{const u=new RegExp(regEscape(i)+"(?!>)","gi");s.title=s.title.replace(u,"<m>$&</m>")}),e.firstOccur>=0){let i=e.firstOccur-d,u=e.lastOccur+d;i<0&&(i=0),i===0&&(u=d*2),u>p.length&&(u=p.length),s.content=p.substr(i,u-i),g.forEach(y=>{const w=new RegExp(regEscape(y)+"(?!>)","gi");s.content=s.content.replace(w,"<m>$&</m>")})}c.push([s,m])}}),o!==0){const r=performance.now();setNotice("success","\u627E\u5230 "+o+" \u6761\u641C\u7D22\u7ED3\u679C\uFF0C\u7528\u65F6 "+Math.round((r-h)*100)/100+" \u6BEB\u79D2~"),c.sort((l,f)=>f[1]-l[1]),createPosts(c)}else setNotice("danger","\u4EC0\u4E48\u90FD\u6CA1\u6709\u627E\u5230\u6B38..."),clearPosts();typeof NProgress<"u"&&NProgress.done()}).catch(n=>{setNotice("danger","\u9519\u8BEF : "+n)})}function keySearch(t){setNotice("info","\u6B63\u5728\u52A0\u8F7D\u641C\u7D22\u6587\u4EF6..."),typeof NProgress<"u"&&NProgress.start(),loadDataSearch(searchDataFile,searchEscape(t))}function inpSearch(){const t=document.getElementById("search-input").value;return window.history.pushState({},0,window.location.href.split("?")[0]+"?s="+t.replace(/\s/g,"+")),keySearch(t),!1}(()=>{const t=getParam("s");t!==""&&(document.getElementById("search-input").value=t,keySearch(t))})();
